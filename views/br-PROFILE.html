<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROFILE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.33/dist/sweetalert2.all.min.js"></script>
    <!-- <link rel="stylesheet" href="/public/css/bootstrap.min.css">
    <script src="/public/js/bootstrap.min.js"></script> -->
    <!-- Internal CSS -->
    <link rel="stylesheet" href="/public/css/PJ-All.css">
</head>

<body class="bgc1">
    <nav class="m-5 p-2">
        <div class="row px-4">
            <div class="col-3 h2 textc1">
                <a href="#"><img id="navprofileimg" alt="" class="rounded-circle"></a>
            </div>
            <div class="col text-end h4 pt-2">
                <a href="#" onclick='history()' class="textc1">HISTORY</a>
                <a href="#" onclick='assetlist()' class="ms-3 textc1">ASSET LIST</a>
                <a href="#" onclick='requeststatus()' class="ms-3 textc1">REQUEST STATUS</a>
                <a class="text-danger ms-3 textc1" onclick='logout()'>LOG OUT</a>
            </div>
        </div>
    </nav>


    <div class="container table1 text-white px-5">
        <h1 class="text-center py-3">PROFILE</h1>
        <div class="container">
            <div class="row">
                <div class="col-4">
                    <div id="profileimg" class="rounded-circle mb-3">

                        <!-- Modal trigger button -->
                        <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#modalEditprofile">
                            <img src="/public/img/Edit_icon.png" alt="" width="30px"
                                style="margin-top: 120px; margin-left: 120px;">
                        </button>
                    </div>
                </div>
                <div class="col-8">
                    <h3>Username :</h3>
                    <h5 id="username">Ethan <!-- Modal trigger button -->
                        <button type="button" class="btn pb-3" data-bs-toggle="modal"
                            data-bs-target="#modalEditusername"><img src="/public/img/Edit_icon.png" alt="" width="20px"
                                style="margin-left: 10px;"></button>
                    </h5>
                    <h3>Email :</h3>
                    <h5>xxxxxxxxxxx@gmail.com</h5>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal Body -->
    <!-- if you want to close by clicking outside the modal, delete the last endpoint:data-bs-backdrop and data-bs-keyboard -->
    <div class="modal fade" id="modalEditprofile" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
        role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-l" role="document">
            <div class="modal-content table1 pb-0">
                <div class="modal-header bg-white rounded-pill m-4 mb-0">
                    <h5 class="modal-title textc1" id="modalTitleId">
                        Edit Profile
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- modal-body -->
                    <form class="p-5" method="post" enctype="multipart/form-data">
                        <div class="btn btn-light rounded-pill">
                            <label for="image_uploads">Choose images to upload (PNG, JPG)</label>
                            <input type="file" id="image_uploads" name="image_uploads" accept=".jpg, .jpeg, .png">
                        </div>
                        <div class="preview text-white text-center">
                            <p>No files currently selected for upload</p>
                        </div>
                    </form>
                    <div class="text-end mt-2 me-2">
                        <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">
                            Close
                        </button>
                        <button class="btn btn-primary rounded-pill" id="btnSaveimg">Save</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal Body -->
    <!-- if you want to close by clicking outside the modal, delete the last endpoint:data-bs-backdrop and data-bs-keyboard -->
    <div class="modal fade" id="modalEditusername" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
        role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
            <div class="modal-content table1 pb-0">
                <div class="modal-header bg-white rounded-pill m-4 mb-0">
                    <h5 class="modal-title textc1" id="modalTitleId">
                        Edit Username
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- modal-body -->
                    <form id="formName" class="table1 p-4" method="post" enctype="multipart/form-data">
                        <label for="newusername" class="text-white h5">New Username</label>
                        <input class="form-control rounded-pill mt-2 mb-4" type="text" name="newusername" id="newusername" required>
                    
                    <div class="text-end mt-2 me-2">
                        <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">
                            Close
                        </button>
                        <button class="btn btn-primary rounded-pill" type="submit">Save</button>
                    </div>
                </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Optional: Place to the bottom of scripts -->
    <script>
        const editusernameModal = new bootstrap.Modal(
            document.getElementById("modalEditusername")
        );

        const editprofileModal = new bootstrap.Modal(
            document.getElementById("modalEditprofile")
        );
        const input = document.querySelector("input");
        const preview = document.querySelector(".preview");

        input.style.opacity = 0;

        input.addEventListener("change", updateImageDisplay);

        function updateImageDisplay() {
            while (preview.firstChild) {
                preview.removeChild(preview.firstChild);
            }

            const curFiles = input.files;
            if (curFiles.length === 0) {
                const para = document.createElement("p");
                para.textContent = "No files currently selected for upload";
                preview.appendChild(para);
            } else {
                const list = document.createElement("ol");
                preview.appendChild(list);

                for (const file of curFiles) {
                    const listItem = document.createElement("li");
                    const para = document.createElement("p");
                    if (validFileType(file)) {
                        para.textContent = `File name ${file.name}, file size ${returnFileSize(
                            file.size,
                        )}.`;
                        const image = document.createElement("img");
                        image.src = URL.createObjectURL(file);
                        image.alt = image.title = file.name;
                        image.style = "width:250px;";

                        listItem.appendChild(image);
                        listItem.appendChild(para);
                    } else {
                        para.textContent = `File name ${file.name}: Not a valid file type. Update your selection.`;
                        listItem.appendChild(para);
                    }

                    list.appendChild(listItem);
                }
            }
        }

        // https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Image_types
        const fileTypes = [
            "image/apng",
            "image/bmp",
            "image/gif",
            "image/jpeg",
            "image/pjpeg",
            "image/png",
            "image/svg+xml",
            "image/tiff",
            "image/webp",
            "image/x-icon",
        ];

        function validFileType(file) {
            return fileTypes.includes(file.type);
        }

        function returnFileSize(number) {
            if (number < 1024) {
                return `${number} bytes`;
            } else if (number >= 1024 && number < 1048576) {
                return `${(number / 1024).toFixed(1)} KB`;
            } else if (number >= 1048576) {
                return `${(number / 1048576).toFixed(1)} MB`;
            }
        }


        const button = document.querySelector("#btnSaveimg");
        button.addEventListener("click", (e) => {
            e.preventDefault();
            if (input.files.length === 0) {
                const para = document.createElement("p");
                para.append("No image!");
                preview.replaceChildren(para);
            } else {
                const para = document.createElement("p");
                para.append("Image uploaded!");
                preview.replaceChildren(para);
                setTimeout(function () {
                    editprofileModal.hide();
                    document.getElementById("profileimg").style.backgroundImage = `url('${URL.createObjectURL(document.querySelector("input").files[0])}')`;
                }, 1000)


            }
        });

        const formName = document.querySelector('#formName');
        formName.onsubmit = async function (e) {
            e.preventDefault();

            setTimeout(function () {
                editusernameModal.hide();
                document.querySelector("#username").innerHTML = `${document.querySelector("#newusername").value}<button type="button" class="btn pb-3" data-bs-toggle="modal" data-bs-target="#modalEditusername"><img src="/public/img/Edit_icon.png" alt="" width="20px" style="margin-left: 10px;"></button>`;
            }, 1000)

        }
        function history() {
            window.location.replace("br-HISTORY.html");
        }
        function assetlist() {
            window.location.replace("br-ASSET_LIST.html");
        }
        function requeststatus() {
            window.location.replace("br-REQUEST_STATUS.html");
        }
        function logout() {
            // alert(".");
            Swal.fire({
                title: 'Log out',
                showCancelButton: true,
                confirmButtonText: 'confirm',
            }).then(function (result) {
                if (result.value) {
                    window.location.href = '/logout';
                }
            });
        }
    </script>
</body>

</html>